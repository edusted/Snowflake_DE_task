# ‚úàÔ∏è Airline Data Warehouse ETL

![Python](https://img.shields.io/badge/Python-3.9%2B-blue)
![Airflow](https://img.shields.io/badge/Apache%20Airflow-2.9-orange)
![Snowflake](https://img.shields.io/badge/Snowflake-Data%20Cloud-blue)
![Docker](https://img.shields.io/badge/Docker-Compose-2496ED)
![Power BI](https://img.shields.io/badge/Power%20BI-Visualization-yellow)

**End-to-End Data Engineering –ø—Ä–æ–µ–∫—Ç**, —Ä–µ–∞–ª–∏–∑—É—é—â–∏–π –ø–æ–ª–Ω—ã–π —Ü–∏–∫–ª –æ–±—Ä–∞–±–æ—Ç–∫–∏ –¥–∞–Ω–Ω—ã—Ö: –æ—Ç –∑–∞–≥—Ä—É–∑–∫–∏ —Å—ã—Ä—ã—Ö CSV —Ñ–∞–π–ª–æ–≤ –¥–æ –ø–æ—Å—Ç—Ä–æ–µ–Ω–∏—è –∞–Ω–∞–ª–∏—Ç–∏—á–µ—Å–∫–æ–π –≤–∏—Ç—Ä–∏–Ω—ã –∏ –¥–∞—à–±–æ—Ä–¥–∞.

–ü—Ä–æ–µ–∫—Ç –¥–µ–º–æ–Ω—Å—Ç—Ä–∏—Ä—É–µ—Ç –ø–æ—Å—Ç—Ä–æ–µ–Ω–∏–µ **ELT-–ø–∞–π–ø–ª–∞–π–Ω–∞** (Extract, Load, Transform) —Å –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ–º —Å–æ–≤—Ä–µ–º–µ–Ω–Ω–æ–π –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä—ã "–ú–µ–¥–∞–ª—å–æ–Ω" (Bronze ‚Üí Silver ‚Üí Gold) –∏ –æ—Ä–∫–µ—Å—Ç—Ä–∞—Ü–∏–µ–π —á–µ—Ä–µ–∑ Apache Airflow.

---

## üèó –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞

–î–∞–Ω–Ω—ã–µ –ø—Ä–æ—Ö–æ–¥—è—Ç —Å–ª–µ–¥—É—é—â–∏–π –ø—É—Ç—å:
1.  **Source:** –õ–æ–∫–∞–ª—å–Ω—ã–µ CSV —Ñ–∞–π–ª—ã —Å –¥–∞–Ω–Ω—ã–º–∏ –æ –ø–æ–ª–µ—Ç–∞—Ö.
2.  **Orchestration:** Apache Airflow (–≤ Docker) —É–ø—Ä–∞–≤–ª—è–µ—Ç –∑–∞–≥—Ä—É–∑–∫–æ–π —Ñ–∞–π–ª–æ–≤ –∏ –∑–∞–ø—É—Å–∫–æ–º –ø—Ä–æ—Ü–µ–¥—É—Ä —Ç—Ä–∞–Ω—Å—Ñ–æ—Ä–º–∞—Ü–∏–∏.
3.  **Data Warehouse (Snowflake):**
    * **Bronze Layer:** –ó–∞–≥—Ä—É–∑–∫–∞ —Å—ã—Ä—ã—Ö –¥–∞–Ω–Ω—ã—Ö "–∫–∞–∫ –µ—Å—Ç—å" (Raw Data) –∏–∑ Stage.
    * **Silver Layer:** –û—á–∏—Å—Ç–∫–∞, –¥–µ–¥—É–ø–ª–∏–∫–∞—Ü–∏—è, –ø—Ä–∏–º–µ–Ω–µ–Ω–∏–µ SCD (Type 1), –ø–æ—Å—Ç—Ä–æ–µ–Ω–∏–µ —Å—Ö–µ–º—ã "–ó–≤–µ–∑–¥–∞" (Facts & Dimensions).
    * **Gold Layer:** –ê–≥—Ä–µ–≥–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ –≤–∏—Ç—Ä–∏–Ω—ã –¥–∞–Ω–Ω—ã—Ö –¥–ª—è –±–∏–∑–Ω–µ—Å-–∞–Ω–∞–ª–∏—Ç–∏–∫–∏.
4.  **Visualization:** Power BI –ø–æ–¥–∫–ª—é—á–∞–µ—Ç—Å—è –Ω–∞–ø—Ä—è–º—É—é –∫ Gold —Å–ª–æ—é.

```mermaid
graph LR
    A[Local CSV] -->|Airflow Upload| B[Snowflake Stage];
    B -->|COPY INTO| C[(Bronze: RAW)];
    C -->|Stored Proc| D[(Silver: Star Schema)];
    D -->|Stored Proc| E[(Gold: Analytics)];
    E -->|Native Connector| F[Power BI Dashboard];
```

---

## üõ† –¢–µ—Ö–Ω–æ–ª–æ–≥–∏—á–µ—Å–∫–∏–π —Å—Ç–µ–∫

* **Infrastructure:** Docker & Docker Compose.
* **Orchestration:** Apache Airflow 2.9 (Official Image).
* **DWH:** Snowflake (Standard Edition).
* **Languages:** SQL (Snowflake Dialect), Python (Airflow DAGs).
* **BI:** Microsoft Power BI Desktop.
* **Version Control:** Git & GitHub.

---

## üöÄ –ö–∞–∫ –∑–∞–ø—É—Å—Ç–∏—Ç—å –ø—Ä–æ–µ–∫—Ç (–ü–æ—à–∞–≥–æ–≤–∞—è –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏—è)

### –®–∞–≥ 1. –ü–æ–¥–≥–æ—Ç–æ–≤–∫–∞ Snowflake

1.  –°–æ–∑–¥–∞–π—Ç–µ –∞–∫–∫–∞—É–Ω—Ç –Ω–∞ [signup.snowflake.com](https://signup.snowflake.com/) (Trial –≤–µ—Ä—Å–∏—è –ø–æ–¥—Ö–æ–¥–∏—Ç).
2.  –í–æ–π–¥–∏—Ç–µ –≤ –∫–æ–Ω—Å–æ–ª—å Snowflake.
3.  –°–∫–æ–ø–∏—Ä—É–π—Ç–µ –≤–∞—à **Account URL** (–æ–Ω –ø–æ–Ω–∞–¥–æ–±–∏—Ç—Å—è –¥–ª—è Airflow –∏ Power BI).
    * *–§–æ—Ä–º–∞—Ç:* `abc12345.us-east-1` (Organization-Account) –∏–ª–∏ –∫–ª–∞—Å—Å–∏—á–µ—Å–∫–∏–π URL –ª–æ–∫–∞—Ç–æ—Ä–∞.

### –®–∞–≥ 2. –ó–∞–ø—É—Å–∫ –∏–Ω—Ñ—Ä–∞—Å—Ç—Ä—É–∫—Ç—É—Ä—ã (Docker)

–£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ —É –≤–∞—Å —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω **Docker Desktop**.

1.  –ö–ª–æ–Ω–∏—Ä—É–π—Ç–µ —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–π:
    ```bash
    git clone [https://github.com/YOUR_USERNAME/snowflake-airflow-etl.git](https://github.com/YOUR_USERNAME/snowflake-airflow-etl.git)
    cd snowflake-airflow-etl
    ```
2.  –ó–∞–ø—É—Å—Ç–∏—Ç–µ Airflow –≤ —Ñ–æ–Ω–æ–≤–æ–º —Ä–µ–∂–∏–º–µ:
    ```bash
    docker-compose up -d
    ```
3.  –ü—Ä–æ–≤–µ—Ä—å—Ç–µ, —á—Ç–æ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä—ã –∑–∞–ø—É—â–µ–Ω—ã:
    ```bash
    docker ps
    ```
4.  –û—Ç–∫—Ä–æ–π—Ç–µ UI Airflow –≤ –±—Ä–∞—É–∑–µ—Ä–µ: [http://localhost:8080](http://localhost:8080).
    * **–õ–æ–≥–∏–Ω:** `airflow`
    * **–ü–∞—Ä–æ–ª—å:** `airflow`

### –®–∞–≥ 3. –ü–æ–¥–∫–ª—é—á–µ–Ω–∏–µ Airflow –∫ Snowflake

1.  –í UI Airflow –ø–µ—Ä–µ–π–¥–∏—Ç–µ –≤ –º–µ–Ω—é **Admin** -> **Connections**.
2.  –°–æ–∑–¥–∞–π—Ç–µ –Ω–æ–≤–æ–µ —Å–æ–µ–¥–∏–Ω–µ–Ω–∏–µ –∏–ª–∏ –æ—Ç—Ä–µ–¥–∞–∫—Ç–∏—Ä—É–π—Ç–µ `snowflake_default`.
3.  –ó–∞–ø–æ–ª–Ω–∏—Ç–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã:
    * **Connection Id:** `snowflake_default`
    * **Conn Type:** `Snowflake`
    * **Host:** `<–≤–∞—à_account_id>.snowflakecomputing.com`
    * **Schema:** `PUBLIC`
    * **Login:** –í–∞—à –ª–æ–≥–∏–Ω Snowflake.
    * **Password:** –í–∞—à –ø–∞—Ä–æ–ª—å.
    * **Account:** `<–≤–∞—à_account_id>` (–ø–µ—Ä–≤–∞—è —á–∞—Å—Ç—å URL –¥–æ —Ç–æ—á–∫–∏).
    * **Warehouse:** `COMPUTE_WH`
    * **Database:** `AIRLINE_DWH`
    * **Role:** `ACCOUNTADMIN` (–∏–ª–∏ `SYSADMIN`, –µ—Å–ª–∏ –Ω–∞—Å—Ç—Ä–æ–µ–Ω—ã –ø—Ä–∞–≤–∞).

### –®–∞–≥ 4. –î–µ–ø–ª–æ–π –æ–±—ä–µ–∫—Ç–æ–≤ –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö (DAG 1)

–ó–∞–ø—É—Å—Ç–∏—Ç–µ DAG **`01_init_snowflake_objects`**.
–≠—Ç–æ—Ç –ø–∞–π–ø–ª–∞–π–Ω –≤—ã–ø–æ–ª–Ω—è–µ—Ç DDL —Å–∫—Ä–∏–ø—Ç—ã –∏–∑ –ø–∞–ø–∫–∏ `sql/` –∏ —Å–æ–∑–¥–∞–µ—Ç —Å—Ç—Ä—É–∫—Ç—É—Ä—É DWH:
* –ë–∞–∑—É –¥–∞–Ω–Ω—ã—Ö `AIRLINE_DWH`.
* –°—Ö–µ–º—ã `BRONZE`, `SILVER`, `GOLD`, `UTILS`.
* File Formats (CSV –ø–∞—Ä—Å–µ—Ä—ã).
* Stored Procedures (–õ–æ–≥–∏–∫–∞ —Ç—Ä–∞–Ω—Å—Ñ–æ—Ä–º–∞—Ü–∏–∏ —Å –ø—Ä–∞–≤–∞–º–∏ `EXECUTE AS OWNER`).

### –®–∞–≥ 5. –ó–∞–ø—É—Å–∫ ETL –ü–∞–π–ø–ª–∞–π–Ω–∞ (DAG 2)

–ó–∞–ø—É—Å—Ç–∏—Ç–µ DAG **`02_airline_etl_pipeline`**.
–û–Ω –≤—ã–ø–æ–ª–Ω–∏—Ç –ø–æ–ª–Ω—ã–π —Ü–∏–∫–ª –æ–±—Ä–∞–±–æ—Ç–∫–∏ –¥–∞–Ω–Ω—ã—Ö:
1.  **Extract:** –ó–∞–≥—Ä—É–∑–∏—Ç –ª–æ–∫–∞–ª—å–Ω—ã–π CSV —Ñ–∞–π–ª –≤ Snowflake Stage.
2.  **Load Bronze:** –í—ã–ø–æ–ª–Ω–∏—Ç –∫–æ–º–∞–Ω–¥—É `COPY INTO` –≤ —Ç–∞–±–ª–∏—Ü—É `RAW_AIRLINE_DATA`.
3.  **Transform Silver:** –†–∞–∑–Ω–µ—Å–µ—Ç –¥–∞–Ω–Ω—ã–µ –ø–æ —Ç–∞–±–ª–∏—Ü–∞–º `DIM_PASSENGER`, `DIM_AIRPORT`, `FACT_FLIGHT` (–æ—á–∏—Å—Ç–∫–∞, –Ω–æ—Ä–º–∞–ª–∏–∑–∞—Ü–∏—è).
4.  **Transform Gold:** –†–∞—Å—Å—á–∏—Ç–∞–µ—Ç –≤–∏—Ç—Ä–∏–Ω—É `FLIGHT_ANALYTICS` (–∞–≥—Ä–µ–≥–∞—Ç—ã –ø–æ —Ä–µ–π—Å–∞–º –∏ –∑–∞–¥–µ—Ä–∂–∫–∞–º).

---

## üìä –ü–æ–¥–∫–ª—é—á–µ–Ω–∏–µ Power BI

–ß—Ç–æ–±—ã –≤–∏–∑—É–∞–ª–∏–∑–∏—Ä–æ–≤–∞—Ç—å —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã:

1.  –û—Ç–∫—Ä–æ–π—Ç–µ **Power BI Desktop**.
2.  –ù–∞–∂–º–∏—Ç–µ **Get Data** -> **Snowflake**.
3.  –í –ø–æ–ª–µ **Server** –≤–≤–µ–¥–∏—Ç–µ –≤–∞—à URL (–±–µ–∑ `https://`).
4.  **Warehouse:** `COMPUTE_WH`.
5.  **Data Connectivity mode:** Import.
6.  –í–≤–µ–¥–∏—Ç–µ —É—á–µ—Ç–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ (User/Password).
7.  –í –Ω–∞–≤–∏–≥–∞—Ç–æ—Ä–µ –≤—ã–±–µ—Ä–∏—Ç–µ: `AIRLINE_DWH` -> `GOLD` -> `FLIGHT_ANALYTICS`.
8.  –ù–∞–∂–º–∏—Ç–µ **Load** –∏ –ø–æ—Å—Ç—Ä–æ–π—Ç–µ –¥–∞—à–±–æ—Ä–¥.

---

## üìÇ –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –ø—Ä–æ–µ–∫—Ç–∞

```text
‚îú‚îÄ‚îÄ dags/
‚îÇ   ‚îú‚îÄ‚îÄ 01_init_snowflake_objects.py  # DAG –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–∏ (DDL)
‚îÇ   ‚îî‚îÄ‚îÄ 02_airline_etl_pipeline.py    # –û—Å–Ω–æ–≤–Ω–æ–π ETL –ø–∞–π–ø–ª–∞–π–Ω
‚îú‚îÄ‚îÄ sql/
‚îÇ   ‚îú‚îÄ‚îÄ 00_ddl/                       # –°–æ–∑–¥–∞–Ω–∏–µ —Ç–∞–±–ª–∏—Ü (Bronze, Silver, Gold)
‚îÇ   ‚îú‚îÄ‚îÄ 01_procedures/                # –•—Ä–∞–Ω–∏–º—ã–µ –ø—Ä–æ—Ü–µ–¥—É—Ä—ã (ELT –ª–æ–≥–∏–∫–∞)
‚îÇ   ‚îî‚îÄ‚îÄ 02_dml/                       # –í—Å–ø–æ–º–æ–≥–∞—Ç–µ–ª—å–Ω—ã–µ —Å–∫—Ä–∏–ø—Ç—ã
‚îú‚îÄ‚îÄ data/                             # –ò—Å—Ö–æ–¥–Ω—ã–µ CSV —Ñ–∞–π–ª—ã (–ø—Ä–∏–º–µ—Ä—ã)
‚îú‚îÄ‚îÄ docker-compose.yaml               # –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è Airflow –∏ —Å–µ—Ä–≤–∏—Å–æ–≤
‚îî‚îÄ‚îÄ README.md                         # –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è –ø—Ä–æ–µ–∫—Ç–∞
```

---

## üí° –ö–ª—é—á–µ–≤—ã–µ –æ—Å–æ–±–µ–Ω–Ω–æ—Å—Ç–∏ —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏

* **Snowflake RBAC:** –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ –º–æ–¥–µ–ª–∏ `EXECUTE AS OWNER` –≤ –ø—Ä–æ—Ü–µ–¥—É—Ä–∞—Ö –ø–æ–∑–≤–æ–ª—è–µ—Ç Airflow –≤—ã–ø–æ–ª–Ω—è—Ç—å —Å–ª–æ–∂–Ω—ã–µ —Ç—Ä–∞–Ω—Å—Ñ–æ—Ä–º–∞—Ü–∏–∏, –∏–º–µ—è –º–∏–Ω–∏–º–∞–ª—å–Ω—ã–µ –ø—Ä–∞–≤–∞, –ø—Ä–∏ —ç—Ç–æ–º –ø—Ä–æ—Ü–µ–¥—É—Ä—ã –≤—ã–ø–æ–ª–Ω—è—é—Ç—Å—è –æ—Ç –∏–º–µ–Ω–∏ –≤–ª–∞–¥–µ–ª—å—Ü–∞ —Å—Ö–µ–º—ã.
* **Handling Duplicates:** –†–µ–∞–ª–∏–∑–æ–≤–∞–Ω–∞ –ª–æ–≥–∏–∫–∞ –¥–µ–¥—É–ø–ª–∏–∫–∞—Ü–∏–∏ –≤ Silver —Å–ª–æ–µ (—á–µ—Ä–µ–∑ `GROUP BY` –ø–µ—Ä–µ–¥ `MERGE`), —á—Ç–æ —Ä–µ—à–∞–µ—Ç –ø—Ä–æ–±–ª–µ–º—É –æ—à–∏–±–æ–∫ `Duplicate row detected` –ø—Ä–∏ –≥—Ä—è–∑–Ω—ã—Ö –≤—Ö–æ–¥–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö.
* **Data Parsing:** –ù–∞—Å—Ç—Ä–æ–µ–Ω –∫–∞—Å—Ç–æ–º–Ω—ã–π `FILE FORMAT` –≤ Snowflake –¥–ª—è –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ–π –æ–±—Ä–∞–±–æ—Ç–∫–∏ CSV —Å –∫–∞–≤—ã—á–∫–∞–º–∏ –∏ –Ω–µ—Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω—ã–º–∏ —Ä–∞–∑–¥–µ–ª–∏—Ç–µ–ª—è–º–∏.
* **Idempotency:** –í—Å–µ —Å–∫—Ä–∏–ø—Ç—ã –∏ DAG–∏ –Ω–∞–ø–∏—Å–∞–Ω—ã –∏–¥–µ–º–ø–æ—Ç–µ–Ω—Ç–Ω–æ ‚Äî –ø–æ–≤—Ç–æ—Ä–Ω—ã–π –∑–∞–ø—É—Å–∫ –Ω–µ –¥—É–±–ª–∏—Ä—É–µ—Ç –¥–∞–Ω–Ω—ã–µ –∏ –Ω–µ –ª–æ–º–∞–µ—Ç –ø–∞–π–ø–ª–∞–π–Ω.

---

### –ê–≤—Ç–æ—Ä
Eduard Stsiablou / eduste
